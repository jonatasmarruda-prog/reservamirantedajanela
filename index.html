<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Trilha Mirante da Janela</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  background:#0f2027;
  color:#fff;
  font-family:Arial;
  text-align:center;
  padding:15px;
}
.container {
  background:#111;
  max-width:420px;
  margin:auto;
  padding:20px;
  border-radius:15px;
}
input, textarea {
  width:90%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}
button {
  width:100%;
  padding:14px;
  margin-top:10px;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.btn-pix { background:#00c6ff; color:#fff; }
.btn-zap { background:#25d366; color:#fff; }
.bloqueado { background:#555; cursor:not-allowed; }
.info { color:#00ffcc; font-weight:bold; }
.alerta { color:#ff5c5c; font-weight:bold; }
</style>
</head>

<body>

<div class="container">

<h2>ğŸŒ„ Trilha Mirante da Janela</h2>
<p>ğŸ“… 25 de Janeiro | â° 4h da manhÃ£</p>
<p>ğŸ’° R$ 15,00 por pessoa</p>

<p class="info">ğŸŸï¸ Vagas restantes: <span id="vagas">...</span></p>

<p class="alerta">
âš ï¸ Se for pagar para mais de uma pessoa, informe o nome de TODOS.
</p>

<div>
  <button onclick="modoUm()">ğŸ‘¤ 1 Pessoa</button>
  <button onclick="modoVarios()">ğŸ‘¥ Mais Pessoas</button>
</div>

<div id="umNome">
  <input type="text" id="nomeUnico" placeholder="Nome da pessoa">
</div>

<div id="variosNomes" style="display:none;">
  <textarea id="listaNomes" rows="4"
    placeholder="Digite um nome por linha"></textarea>
</div>

<input type="number" id="qtd" value="1" min="1">

<p id="total">Total: R$ 15,00</p>

<button id="btnPix" class="btn-pix" onclick="copiarPix()">ğŸ’³ COPIAR PIX</button>

<p id="msg"></p>

<div id="confirmacao" style="display:none;">
  <p class="info">âœ… Pagamento realizado!</p>
  <p>Clique abaixo e envie o comprovante para o Jonatas:</p>
  <a id="linkWhats"
     class="btn-zap"
     style="display:block;text-decoration:none;">
     ğŸ“² ENVIAR COMPROVANTE
  </a>
</div>

</div>

<script>
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "trilha-mirante.firebaseapp.com",
  databaseURL: "https://trilha-mirante-default-rtdb.firebaseio.com",
  projectId: "trilha-mirante",
  storageBucket: "trilha-mirante.appspot.com",
  messagingSenderId: "SEU_ID",
  appId: "SEU_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const ref = firebase.database().ref("vagas");

const valor = 15;
let modo = "um";

function modoUm() {
  modo = "um";
  document.getElementById("umNome").style.display = "block";
  document.getElementById("variosNomes").style.display = "none";
}

function modoVarios() {
  modo = "varios";
  document.getElementById("umNome").style.display = "none";
  document.getElementById("variosNomes").style.display = "block";
}

ref.on("value", snap => {
  const vagas = snap.val();
  document.getElementById("vagas").innerText = vagas;

  if (vagas <= 0) {
    document.getElementById("btnPix").disabled = true;
    document.getElementById("btnPix").innerText = "VAGAS ESGOTADAS";
    document.getElementById("btnPix").classList.add("bloqueado");
  }
});

function copiarPix() {
  let nomes = modo === "um"
    ? document.getElementById("nomeUnico").value
    : document.getElementById("listaNomes").value;

  if (!nomes.trim()) {
    alert("âš ï¸ Informe o nome da(s) pessoa(s).");
    return;
  }

  const qtd = document.getElementById("qtd").value;
  const total = qtd * valor;

  ref.transaction(v => v >= qtd ? v - qtd : v);

  navigator.clipboard.writeText("trilheiros.roomt@gmail.com");

  const msg =
    "OlÃ¡ Jonatas! ğŸ˜Š%0A" +
    "ConfirmaÃ§Ã£o da *Trilha Mirante da Janela* ğŸŒ„%0A%0A" +
    "ğŸ‘¤ Nome(s): " + nomes.replace(/\n/g, ", ") + "%0A" +
    "ğŸŸï¸ Vagas: " + qtd + "%0A" +
    "ğŸ’° Valor: R$ " + total.toFixed(2).replace(".", ",") + "%0A%0A" +
    "Pagamento realizado via Pix âœ…";

  document.getElementById("confirmacao").style.display = "block";
  document.getElementById("linkWhats").href =
    "https://wa.me/5566996926174?text=" + msg;
}
</script>

</body>
</html>
